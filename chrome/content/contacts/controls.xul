<?xml version="1.0"?>
<?xml-stylesheet href="chrome://sameplace/skin/contacts/controls.css"?>
<?xul-overlay href="status.xul"?>

<!--
  Copyright 2006-2007 by Massimiliano Mirra
  
  This file is part of SamePlace.
  
  SamePlace is free software; you can redistribute it and/or modify it
  under the terms of the GNU General Public License as published by the
  Free Software Foundation; either version 3 of the License, or (at your
  option) any later version.
  
  SamePlace is distributed in the hope that it will be useful, but
  WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  General Public License for more details.
  
  You should have received a copy of the GNU General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
  
  Author: Massimiliano Mirra, <bard [at] hyperstruct [dot] net>
-->


<overlay xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

  <script type="application/x-javascript" src="controls.js"/>

  <keyset id="keys">
    <key modifiers="control" key=" "
         oncommand="/*addClass($('#controls .dock-tools'), 'active');*/
                    var fieldBox = $('#controls .field.filter');
                    fieldBox.collapsed = !fieldBox.collapsed;
                    if(!fieldBox.collapsed)
                    fieldBox.firstChild.focus();"/>
  </keyset>

  <stack id="contacts-stack">
    <vbox id="controls" flex="1" mousethrough="always">
      <box id="controls-upper"
           orient="horizontal"
           align="start">
        <vbox class="control dock" mousethrough="never" flex="1">
          <hbox class="dock-tools"
                onmouseover="hoveredDockContent(event);"
                onmouseout="$(this, '^ .control .inline-tooltip').hidden = true;">
            <image class="icon presence-indicator" popup="status-popup"
                   helptext="Change Status"/>
            <image class="icon people" popup="people-popup"
                   helptext="Edit Contacts"/>
            <image class="icon filter"
                   onclick="var field = $('#controls .field.filter');
                            field.collapsed = !field.collapsed;
                            if(!field.collapsed) field.focus;
                            /*this.nextSibling.collapsed = !this.nextSibling.collapsed;
                            if(!this.nextSibling.collapsed) this.nextSibling.firstChild.focus();*/"
                   helptext="Search Contacts (Control+Space)"/>
            <vbox class="field filter" pack="center" collapsed="true">
              <textbox value="Type part of nick…"
                       onblur="blurredFilterField(this);"
                       oninput="inputInFilterField(this);"
                       onkeypress="keypressInInputField(event);"
                       onfocus="focusedFilterField(this);"/>
            </vbox>
            <image class="icon sort" popup="sort-popup"
                   helptext="Sort Contacts"/>
            <image class="icon help" popup="help-popup"
                   helptext="Help"/>
            <image class="icon tools" popup="tools-popup"
                   helptext="Tools"/>
          </hbox>

          <hbox class="inline-tooltip"
                mousethrough="always"
                hidden="true">
            <label crop="end" flex="1"/>
          </hbox>
        </vbox>

        <vbox class="control scroll-arrow scroll-arrow-up"
              onmouseover="scroller.mouseMovedOnScrollUp(event);"
              onmouseout="scroller.mouseLeftScroller(event);
                          this.setAttribute('speed', '0');"
              onmousemove="var distance = Math.abs(
                               this.boxObject.height -
                               (event.clientY-this.boxObject.y));
                           scroller.increment = -Math.floor(distance/2);
                           this.setAttribute('speed',
                                             Math.floor(distance*8/this.boxObject.height));"
              mousethrough="never"
              flex="1">
          <image/>
        </vbox>
      </box>

      <spacer flex="1" mousethrough="always"/>

      <vbox class="control offline-notice" hidden="true">
        <description class="notice">
          You're offline.
        </description>

        <description class="action"
                     onclick="requestedConnection();">
          Connect »
        </description>
      </vbox>

      <spacer flex="2" mousethrough="always"/>

      <hbox>
        <spacer flex="1"/>
        <vbox class="control scroll-arrow scroll-arrow-down"
              onmouseover="scroller.mouseMovedOnScrollDown(event);"
              onmouseout="scroller.mouseLeftScroller(event);
                          this.setAttribute('speed', '0');"
              onmousemove="var distance = Math.abs(event.clientY-this.boxObject.y);
                           scroller.increment = Math.floor(distance/2);
                           this.setAttribute(
                               'speed',
                               Math.floor(distance*8/this.boxObject.height));"
              mousethrough="never"
              flex="1">
          <image/>
        </vbox>
        <spacer flex="1"/>        
      </hbox>
    </vbox>
  </stack>
</overlay>
